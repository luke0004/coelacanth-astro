---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import { PATHS, SECTIONS, SITE } from '../../../config';

export async function getStaticPaths() {
  const posts = await getCollection('logbook');

  // Get all unique tags
  const tags = [...new Set(posts.flatMap(post => post.data.tags || []))];

  return tags.map(tag => ({
    params: { tag: tag.toLowerCase() },
    props: {
      tag,
      posts: posts
        .filter(post => post.data.tags?.includes(tag))
        .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf()),
    },
  }));
}

const { tag, posts } = Astro.props;
---

<BaseLayout title={tag} description={`${SECTIONS.logbook} entries tagged with ${tag}.`}>
  <h2>{tag}</h2>
  {posts.map(post => (
    <article class="post-card">
      {post.data.image && (
        <a href={`${PATHS.logbook}/${post.slug}/`} class="post-thumbnail">
          <Image src={post.data.image} alt={post.data.title} width={150} height={100} />
        </a>
      )}
      <div class="post-content">
        <small>{post.data.date.toLocaleDateString(SITE.locale)}</small>
        <b><a href={`${PATHS.logbook}/${post.slug}/`}>{post.data.title}</a></b>
        {post.data.description && <p>{post.data.description}</p>}
      </div>
    </article>
  ))}
  <p><a href={`${PATHS.logbook}/`}>‚Üê Back to {SECTIONS.logbook}</a></p>
</BaseLayout>
