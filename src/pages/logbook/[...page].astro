---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

export async function getStaticPaths({ paginate }) {
  const posts = (await getCollection('logbook')).sort(
    (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
  );
  return paginate(posts, { pageSize: 10 });
}

const { page } = Astro.props;
---

<BaseLayout title="Logbook – Coelacanth" description="Sailing voyages and refit notes from SV Coelacanth, a Hutting 40 exploring the North Sea and beyond.">
  <h2>Logbook</h2>
  {page.data.map(post => (
    <article class="post-card">
      {post.data.image && (
        <a href={`/logbook/${post.slug}/`} class="post-thumbnail">
          <Image src={post.data.image} alt={post.data.title} width={150} height={100} />
        </a>
      )}
      <div class="post-content">
        <small>{post.data.date.toLocaleDateString('en-GB')}</small>
        <b><a href={`/logbook/${post.slug}/`}>{post.data.title}</a></b>
        {post.data.description && <p>{post.data.description}</p>}
      </div>
    </article>
  ))}

  {(page.url.prev || page.url.next) && (
    <nav class="pagination">
      {page.url.prev ? (
        <a href={page.url.prev}>← Newer</a>
      ) : (
        <span></span>
      )}
      <span class="page-info">Page {page.currentPage} of {page.lastPage}</span>
      {page.url.next ? (
        <a href={page.url.next}>Older →</a>
      ) : (
        <span></span>
      )}
    </nav>
  )}
</BaseLayout>
